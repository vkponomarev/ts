<?php

/**
 * @var $this frontend\controllers\YearsController
 *
 * @var $calendarByMonth common\components\calendar\CalendarByMonth
 * @var $dateData common\components\date\DateData
 * @var $countriesData common\components\countries\CountriesData
 * @var $holidaysData common\components\holidays\HolidaysByCountryByYear array
 * @var $holidaysTypesData common\components\holidaysTypes\HolidaysTypesData
 * @var $countryData common\components\country\CountryData
 * @var $calendarNameOfMonths common\components\calendar\CalendarNameOfMonths
 * @var $calendarNameOfDaysInWeek common\components\calendar\CalendarNameOfDaysInWeek
 * @var $PDFCalendarsData common\components\PDFCalendars\PDFCalendarsYearlyExists
 * @var $getParamsByCalendarYears common\components\getParams\GetParamsByCalendarYears
 * @var $holidaysRange common\components\holidays\HolidaysRange
 * @var $countryURL array ['url','id','defaultID']
 *
 *
 */

$moon = new \common\components\moon\Moon();
?><a name="calendar-<?= $dateData['year']['current'] ?>"></a><h1 class=main-page-h1><?= Yii::$app->params['text']['h1'] ?></h1><hr><div class=row><?php /***************************** */ ?><?php /***************************** Сегодняшний месяц*/ ?><?php /***************************** */ ?><div class="col-xxs-12 col-xs-6 current-date"><div class=current-date-div><div class=current-date-one><div class=current-date-year><?= $calendarNameOfMonths[$dateData['month']['numberSimple']] ?><br><span class=current-date-month><?= $dateData['year']['current'] ?>&nbsp;<?= Yii::t('app', 'year'); ?></span></div></div><div class=current-date-text><?= Yii::$app->params['text']['text1'] ?></div></div></div><?php /***************************** */ ?><?php /***************************** Выберите страну*/ ?><?php /***************************** */ ?><div class="col-xxs-12 col-xs-6 c-links-mp"><div class=c-links-block><div class="col-xs-6 c-links-mp-months"><a href="/<?= Yii::$app->language ?>/calendar/moon/phases/months/<?= $dateData['year']['current'] ?>-<?= $dateData['month']['number'] ?>/new-moon/"><?= Yii::t('app', 'New moon') ?></a><br><a href="/<?= Yii::$app->language ?>/calendar/moon/phases/months/<?= $dateData['year']['current'] ?>-<?= $dateData['month']['number'] ?>/waxing-moon/"><?= Yii::t('app', 'Waxing moon') ?></a><br></div><div class="col-xs-6 c-links-mp-months"><a href="/<?= Yii::$app->language ?>/calendar/moon/phases/months/<?= $dateData['year']['current'] ?>-<?= $dateData['month']['number'] ?>/full-moon/"><?= Yii::t('app', 'Full moon') ?></a><br><a href="/<?= Yii::$app->language ?>/calendar/moon/phases/months/<?= $dateData['year']['current'] ?>-<?= $dateData['month']['number'] ?>/waning-moon/"><?= Yii::t('app', 'Waning moon') ?></a><br></div></div><div class=c-links-block><hr class=hr-1></div></div></div><br><br><hr><?php /***************************** */ ?><?php /***************************** Верхняя плашка календаря с месяцами туда сюда*/ ?><?php /***************************** */ ?><div class=row><div class="col-xxs-12 col-xs-4 c-prev-next-left"><?php if ($dateData['year']['previous'] == '0000' && $dateData['month']['numberSimple'] == 1): ?><?php else: ?><?php if ($dateData['month']['numberSimple'] == 1): ?><a href="/<?= Yii::$app->language ?>/calendar/moon/phases/months/<?= $dateData['year']['previous'] ?>-<?= str_pad(12, 2, '0', STR_PAD_LEFT) ?>/<?= $phaseURL ?>/"><?= $calendarNameOfMonths[12] ?></a><?php else: ?><a href="/<?= Yii::$app->language ?>/calendar/moon/phases/months/<?= $dateData['year']['current'] ?>-<?= str_pad($dateData['month']['numberSimple'] - 1, 2, '0', STR_PAD_LEFT) ?>/<?= $phaseURL ?>/"><?= $calendarNameOfMonths[$dateData['month']['numberSimple'] - 1] ?></a><?php endif; ?><?php endif; ?></div><div class="col-xxs-12 col-xs-4 c-prev-next-center"><?= $calendarNameOfMonths[$dateData['month']['numberSimple']] ?></div><div class="col-xxs-12 col-xs-4 c-prev-next-right"><?php if ($dateData['year']['current'] == '9999' && $dateData['month']['numberSimple'] == 12): ?><?php else: ?><?php if ($dateData['month']['numberSimple'] == 12): ?><a href="/<?= Yii::$app->language ?>/calendar/moon/phases/months/<?= $dateData['year']['next'] ?>-<?= str_pad(1, 2, '0', STR_PAD_LEFT) ?>/<?= $phaseURL ?>/"><?= $calendarNameOfMonths[1] ?></a><?php else: ?><a href="/<?= Yii::$app->language ?>/calendar/moon/phases/months/<?= $dateData['year']['current'] ?>-<?= str_pad($dateData['month']['numberSimple'] + 1, 2, '0', STR_PAD_LEFT) ?>/<?= $phaseURL ?>/"><?= $calendarNameOfMonths[$dateData['month']['numberSimple'] + 1] ?></a><?php endif; ?><?php endif; ?></div></div><hr><?php if ($PDFCalendarsData['exists']): ?><div class=row><div class="col-xxs-12 c-prev-next-right"><a href="#download-calendar-<?= $dateData['year']['current'] ?>"class="btn btn-default"><span class="fa fa-lg fa-print"></span>&nbsp;<?= Yii::t('app', 'Print'); ?></a></div></div><br><?php endif; ?><?php /***************************** */ ?><?php /***************************** Календарь с отмеченными праздниками конкретнрой страны*/ ?><?php /***************************** */ ?><div class="row rflex myear"><?php
    $countMonths = $dateData['month']['numberSimple'] - 1;
    $countWeeks = 0;
    //(new \common\components\dump\Dump())->printR($calendarByMonth);die;


    foreach ($calendarByMonth['calendar'] as $months) :?><?php $countMonths++; ?><div class="col-xxs-12 mmonth"><div class=mmonth-name><?= $calendarNameOfMonths[$countMonths]; ?></div><div class=mweek-name><?php for ($i = 1; $i <= 7; $i++): ?><div class=mday-name><?= $calendarNameOfDaysInWeek[$i]; ?></div><?php endfor; ?></div><?php foreach ($months as $week): ?><div class=mweek><?php for ($i = 1; $i <= 5; $i++): ?><?php if (isset($week[$i]['monthDay'])): ?><div class="mday<?= ($week[$i]['newMoon'] == 1 && $phaseURL == 'new-moon') ? ' md-one' : '' ?><?= ($week[$i]['fullMoon'] == 1 && $phaseURL == 'full-moon') ? ' md-one' : '' ?><?= ($week[$i]['waningCrescent'] == 1  && $phaseURL == 'waning-moon' && $week[$i]['newMoon'] == 0 && $week[$i]['fullMoon'] == 0) ? ' md-one' : '' ?><?= ($week[$i]['waningMoon'] == 1  && $phaseURL == 'waning-moon' && $week[$i]['newMoon'] == 0 && $week[$i]['fullMoon'] == 0) ? ' md-one' : '' ?><?= ($week[$i]['waxingCrescent'] == 1  && $phaseURL == 'waxing-moon' && $week[$i]['newMoon'] == 0 && $week[$i]['fullMoon'] == 0) ? ' md-one' : '' ?><?= ($week[$i]['waxingMoon'] == 1  && $phaseURL == 'waxing-moon' && $week[$i]['newMoon'] == 0 && $week[$i]['fullMoon'] == 0) ? ' md-one' : '' ?>"><span><?= $week[$i]['monthDay']; ?><br><img src="/pictures/moon-phases/<?= $moon->pictures($week[$i], $calendarByMonth['moonPhases']) ?>"width=18><br><?= $calendarByMonth['moonDay'][$week[$i]['date']]; ?></span></div><?php else: ?><div class=mno-day><span></span></div><?php endif; ?><?php endfor; ?><?php for ($i = 6; $i <= 7; $i++): ?><?php if (isset($week[$i]['monthDay'])): ?><div class="mday-off<?= ($week[$i]['newMoon'] == 1 && $phaseURL == 'new-moon') ? ' md-one' : '' ?><?= ($week[$i]['fullMoon'] == 1 && $phaseURL == 'full-moon') ? ' md-one' : '' ?><?= ($week[$i]['waningCrescent'] == 1  && $phaseURL == 'waning-moon' && $week[$i]['newMoon'] == 0 && $week[$i]['fullMoon'] == 0) ? ' md-one' : '' ?><?= ($week[$i]['waningMoon'] == 1  && $phaseURL == 'waning-moon' && $week[$i]['newMoon'] == 0 && $week[$i]['fullMoon'] == 0) ? ' md-one' : '' ?><?= ($week[$i]['waxingCrescent'] == 1  && $phaseURL == 'waxing-moon' && $week[$i]['newMoon'] == 0 && $week[$i]['fullMoon'] == 0) ? ' md-one' : '' ?><?= ($week[$i]['waxingMoon'] == 1  && $phaseURL == 'waxing-moon' && $week[$i]['newMoon'] == 0 && $week[$i]['fullMoon'] == 0) ? ' md-one' : '' ?>"><span><?= $week[$i]['monthDay']; ?><br><img src="/pictures/moon-phases/<?= $moon->pictures($week[$i], $calendarByMonth['moonPhases']) ?>"width=18><br><?= $calendarByMonth['moonDay'][$week[$i]['date']]; ?></span></div><?php else: ?><div class=mno-day><span></span></div><?php endif; ?><?php endfor; ?></div><?php endforeach; ?></div><?php endforeach; ?></div><br><hr><br><?php /***************************** */ ?><?php /***************************** Фазы луны*/ ?><?php /***************************** */ ?><a name="moon-phases-<?= $dateData['year']['current'] ?>"></a><h2 class=main-page-h1><?php if ($phaseURL == 'new-moon') : ?><?= Yii::t('app', 'New moon phases for {month} {year}', [
            'year' => $dateData['year']['current'],
            'month' => $calendarNameOfMonths[$dateData['month']['numberSimple']],
        ]) ?><?php endif; ?><?php if ($phaseURL == 'waxing-moon') : ?><?= Yii::t('app', 'Waxing moon phases for {month} {year}', [
            'year' => $dateData['year']['current'],
            'month' => $calendarNameOfMonths[$dateData['month']['numberSimple']],
        ]) ?><?php endif; ?><?php if ($phaseURL == 'full-moon') : ?><?= Yii::t('app', 'Full moon phases for {month} {year}', [
            'year' => $dateData['year']['current'],
            'month' => $calendarNameOfMonths[$dateData['month']['numberSimple']],
        ]) ?><?php endif; ?><?php if ($phaseURL == 'waning-moon') : ?><?= Yii::t('app', 'Waning moon phases for {month} {year}', [
            'year' => $dateData['year']['current'],
            'month' => $calendarNameOfMonths[$dateData['month']['numberSimple']],
        ]) ?><?php endif; ?></h2><br><br><div class="row rflex"><?php foreach ($calendarByMonth['moonMonth'] as $moonMonth): ?><?php if (isset($moonMonth['start']) && isset($moonMonth['end'])) : ?><?php //$moonMonthStart = (new \DateTime($moonMonth['start']))->format('Y-m-d'); ?><?php //$moonMonthEnd = (new \DateTime($moonMonth['end']))->format('Y-m-d'); ?><div class="col-xxs-12 col-xs-6 col-sm-6 moon-month"><table class=moon-phases-table><?php foreach ($calendarByMonth['moonPhases'] as $moonPhaseName => $moonPhase): ?><?php foreach ($moonPhase as $moonPhaseDate => $value): ?><?php //$moonPhaseDate = (new \DateTime($moonPhaseDate))->format('Y-m-d'); ?><?php if ($moonPhaseDate >= $moonMonth['start'] && $moonPhaseDate <= ($moonMonth['end'])) : ?><?php $dateFormat = new \DateTime($moonPhaseDate) ?><?php if ($phaseURL == 'new-moon') : ?><?php if ($moonPhaseName == 'newMoon') : ?><tr class=moon-phases-tr><td><?= Yii::t('app', 'New moon') ?><td class=moon-phases-img><img src=/pictures/moon-phases/moon-0-1.png width=18><td><?= Yii::$app->formatter->asDate($dateFormat, 'medium'); ?></tr><?php endif; ?><?php endif; ?><?php if ($phaseURL == 'waxing-moon') : ?><?php if ($moonPhaseName == 'waxingCrescentStart') : ?><tr class=moon-phases-tr><td><?= Yii::t('app', 'Waxing crescent') ?><td class=moon-phases-img><img src=/pictures/moon-phases/moon-0-2.png width=18> <img src=/pictures/moon-phases/moon-0-4.png width=18><td><?= Yii::t('app', 'from') . ' ' . Yii::$app->formatter->asDate($dateFormat, 'medium'); ?><?php endif; ?><?php if ($moonPhaseName == 'waxingCrescentEnd') : ?><?= ' ' . Yii::t('app', 'to') . ' ' . Yii::$app->formatter->asDate($dateFormat, 'medium'); ?></tr><?php endif; ?><?php if ($moonPhaseName == 'moonFirstQuarter') : ?><tr class=moon-phases-tr><td><?= Yii::t('app', 'Moon first quarter') ?><td class=moon-phases-img><img src=/pictures/moon-phases/moon-0-5.png width=18><td><?= Yii::$app->formatter->asDate($dateFormat, 'medium'); ?></tr><?php endif; ?><?php if ($moonPhaseName == 'growingMoonStart') : ?><tr class=moon-phases-tr><td><?= Yii::t('app', 'Growing moon') ?><td class=moon-phases-img><img src=/pictures/moon-phases/moon-0-6.png width=18> <img src=/pictures/moon-phases/moon-0-8.png width=18><td><?= Yii::t('app', 'from') . ' ' . Yii::$app->formatter->asDate($dateFormat, 'medium'); ?><?php endif; ?><?php if ($moonPhaseName == 'growingMoonEnd') : ?><?= ' ' . Yii::t('app', 'to') . ' ' . Yii::$app->formatter->asDate($dateFormat, 'medium'); ?></tr><?php endif; ?><?php endif; ?><?php if ($phaseURL == 'full-moon') : ?><?php if ($moonPhaseName == 'fullMoon') : ?><tr class=moon-phases-tr><td><?= Yii::t('app', 'Full moon') ?><td class=moon-phases-img><img src=/pictures/moon-phases/moon-1-0.png width=18><td><?= Yii::$app->formatter->asDate($dateFormat, 'medium'); ?></tr><?php endif; ?><?php endif; ?><?php if ($phaseURL == 'waning-moon') : ?><?php if ($moonPhaseName == 'waningMoonStart') : ?><tr class=moon-phases-tr><td><?= Yii::t('app', 'Waning moon') ?><td class=moon-phases-img><img src=/pictures/moon-phases/moon-1-1.png width=18> <img src=/pictures/moon-phases/moon-1-3.png width=18><td><?= Yii::t('app', 'from') . ' ' . Yii::$app->formatter->asDate($dateFormat, 'medium'); ?><?php endif; ?><?php if ($moonPhaseName == 'waningMoonEnd') : ?><?= ' ' . Yii::t('app', 'to') . ' ' . Yii::$app->formatter->asDate($dateFormat, 'medium'); ?></tr><?php endif; ?><?php if ($moonPhaseName == 'moonThirdQuarter') : ?><tr class=moon-phases-tr><td><?= Yii::t('app', 'Moon third quarter') ?><td class=moon-phases-img><img src=/pictures/moon-phases/moon-1-4.png width=18><td><?= Yii::$app->formatter->asDate($dateFormat, 'medium'); ?></tr><?php endif; ?><?php if ($moonPhaseName == 'waningCrescentStart') : ?><tr class=moon-phases-tr><td><?= Yii::t('app', 'Waning crescent') ?><td class=moon-phases-img><img src=/pictures/moon-phases/moon-1-5.png width=18> <img src=/pictures/moon-phases/moon-1-7.png width=18><td><?= Yii::t('app', 'from') . ' ' . Yii::$app->formatter->asDate($dateFormat, 'medium'); ?><?php endif; ?><?php if ($moonPhaseName == 'waningCrescentEnd') : ?><?= ' ' . Yii::t('app', 'to') . ' ' . Yii::$app->formatter->asDate($dateFormat, 'medium'); ?></tr><?php endif; ?><?php endif; ?><?php endif; ?><?php endforeach ?><?php endforeach ?></table></div><?php endif; ?><?php endforeach ?></div><br><hr><?php /***************************** */ ?><?php /***************************** Ссылки на PDF календари*/ ?><?php /***************************** */ ?><?php if ($PDFCalendarsData['exists']): ?><br><a name="download-calendar-<?= $dateData['year']['current'] ?>"></a><h2 class=main-page-h1><?= Yii::t('app', 'Download and print PDF lunar calendar (moon phases) for {month} {year}', [
            'year' => $dateData['year']['current'],
            'month' => $calendarNameOfMonths[$dateData['month']['numberSimple']],
        ]) ?></h2><br><br><div class="row rflex"><?php foreach ($PDFCalendarsData['pdf'] as $key => $pdf): ?><?php if ($pdf['pdfExists']): ?><div class="col-xxs-12 col-xs-6 col-lg-3 col-md-4 d-center pdf-download"><?php if ($key == 'moonPNoHolidays'): ?><div class=pdf-header><?= Yii::t('app', 'Portrait lunar calendar for the year') ?></div><?php endif; ?><?php if ($key == 'moonLNoHolidays'): ?><div class=pdf-header><?= Yii::t('app', 'Landscape lunar calendar for the year') ?></div><?php endif; ?><a href="<?= $pdf['imgPathRelative'] ?>"class=lightzoom><img src="<?= $pdf['imgPathRelative'] ?>"width=100% alt=""class=c-download-img> </a><a href="<?= $pdf['pdfPathRelative'] ?>"class="btn btn-success c-download-button"target=_blank download><?= Yii::t('app', 'Download') ?></a><br><a href="<?= $pdf['pdfPathRelative'] ?>"class="btn btn-success c-download-button"target=_blank><?= Yii::t('app', 'Print') ?></a></div><?php endif; ?><?php endforeach; ?></div><?php else: ?><?php endif; ?>